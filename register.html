<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventia'24 | GDSC KARE</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon-32x32.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="register.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
    </script>
    <script type="text/javascript">
        (function () {
            emailjs.init({
                publicKey: "ZBwXg4cwShdqUvSfH",
            });
        })();
    </script>
</head>

<body>
    <nav>
        <div class="navWrapper">
            <div class="logo">
                <img src="./assets/gdsckare.jpeg" alt="">
            </div>
            <div class="nav-links">
                <ul>
                    <li><a href="https://linktr.ee/gdsc_kare" target="_blank">linktree</a></li>
                </ul>
            </div>
        </div>

        </div>

    </nav>

    <div class="registerBodyContent">

        <h1>Inventia '24 Registration</h1>

        <form class="registerForm">

            <div class="labelAndInput">
                <label for="team_name">Team Name</label>
                <input required type="text" id="team_name">
            </div>

            <div class="labelAndInput">
                <label for="team_size">Team Size</label>
                <select id="team_size" onchange="teamSizeChanged()">
                    <option value="4" selected>4</option>
                </select>
            </div>

            <div class="splitter splitter1"></div>

            <div class="labelAndInput">
                <label for="team_leader_name">Team Lead Name</label>
                <input required type="text" id="team_leader_name">
            </div>

            <div class="labelAndInput">
                <label for="team_leader_reg">Team Lead Register No</label>
                <input required type="number" id="team_leader_reg">
            </div>

            <div class="labelAndInput">
                <label for="team_leader_email">Team Lead Email</label>
                <input required type="email" id="team_leader_email">
            </div>

            <div class="labelAndInput">
                <label for="team_leader_number">Team Lead Whatsapp Number</label>
                <input required type="number" id="team_leader_number">
            </div>

            <div class="splitter splitter1"></div>

            <div class="labelAndInput">
                <label for="team_member1_name">Team Member 1 Name</label>
                <input required type="text" id="team_member1_name">
            </div>

            <div class="labelAndInput">
                <label for="team_member1_reg">Team Member 1 Register No</label>
                <input required type="number" id="team_member1_reg">
            </div>

            <div class="labelAndInput">
                <label for="team_member1_email">Team Member 1 Email</label>
                <input required type="email" id="team_member1_email">
            </div>

            <div class="labelAndInput">
                <label for="team_member1_number">Team Member 1 Whatsapp No</label>
                <input required type="number" id="team_member1_number">
            </div>

            <div class="splitter splitter2"></div>

            <div class="teamMember2Details">
                <div class="labelAndInput">
                    <label for="team_member2_name">Team Member 2 Name</label>
                    <input required type="text" id="team_member2_name">
                </div>

                <div class="labelAndInput">
                    <label for="team_member2_reg">Team Member 2 Register No</label>
                    <input required type="number" id="team_member2_reg">
                </div>

                <div class="labelAndInput">
                    <label for="team_member2_email">Team Member 2 Email</label>
                    <input required type="email" id="team_member2_email">
                </div>

                <div class="labelAndInput">
                    <label for="team_member2_number">Team Member 2 Whatsapp No</label>
                    <input required type="number" id="team_member2_number">
                </div>
            </div>

            <div class="splitter splitter3"></div>


            <div class="teamMember3Details">
                <div class="labelAndInput">
                    <label for="team_member3_name">Team Member 3 Name</label>
                    <input required type="text" id="team_member3_name">
                </div>

                <div class="labelAndInput">
                    <label for="team_member3_reg">Team Member 3 Register No</label>
                    <input required type="number" id="team_member3_reg">
                </div>

                <div class="labelAndInput">
                    <label for="team_member3_email">Team Member 3 Email</label>
                    <input required type="email" id="team_member3_email">
                </div>

                <div class="labelAndInput">
                    <label for="team_member3_number">Team Member 3 Whatsapp No</label>
                    <input required type="number" id="team_member3_number">
                </div>
            </div>

            <div class="splitter splitter4"></div>

            <div class="labelAndInput">
                <label for="solution_title">Enter your solution's title/name</label>
                <input required type="text" id="solution_title">
            </div>

            <div class="labelAndInput">
                <label for="solution_description">Enter your solution's description (max 1500 characters)</label>
                <div class="textareaContainer">
                    <textarea required id="solution_description" minlength="100" maxlength="1500"></textarea>
                </div>
            </div>

            <div class="labelAndInput">
                <label for="solution_description">Which SDG Goal(s) does your solution satisfy?</label>
                <div class="sdgGoalsContainer">
                    <div>
                        <input type="checkbox" name="1_no_poverty" id="1_no_poverty">
                        <label for="1_no_poverty">SDG 1 - No Poverty</label>
                    </div>
                    <div>
                        <input type="checkbox" name="2_zero_hunger" id="2_zero_hunger">
                        <label for="2_zero_hunger">SDG 2 - Zero Hunger</label>
                    </div>
                    <div>
                        <input type="checkbox" name="3_good_health" id="3_good_health">
                        <label for="3_good_health">SDG 3 - Good Health and Well-being</label>
                    </div>
                    <div>
                        <input type="checkbox" name="4_quality_education" id="4_quality_education">
                        <label for="4_quality_education">SDG 4 - Quality Education</label>
                    </div>
                    <div>
                        <input type="checkbox" name="5_gender_equality" id="5_gender_equality">
                        <label for="5_gender_equality">SDG 5 - Gender Equality</label>
                    </div>
                    <div>
                        <input type="checkbox" name="6_clean_water_and_sanitation" id="6_clean_water_and_sanitation">
                        <label for="6_clean_water_and_sanitation">SDG 6 - Clean Water and Sanitation</label>
                    </div>
                    <div>
                        <input type="checkbox" name="8_decent_work_and_econimic_growth"
                            id="8_decent_work_and_econimic_growth">
                        <label for="8_decent_work_and_econimic_growth">SDG 8 - Decent Work and Economic Growth</label>
                    </div>
                    <div>
                        <input type="checkbox" name="9_industy_innovation_infrastructure"
                            id="9_industy_innovation_infrastructure">
                        <label for="9_industy_innovation_infrastructure">SDG 9 - Industy, Innovation and
                            Infrastructure</label>
                    </div>
                    <div>
                        <input type="checkbox" name="10_reduced_inequality" id="10_reduced_inequality">
                        <label for="10_reduced_inequality">SDG 10 - Reduced Inequality</label>
                    </div>
                    <div>
                        <input type="checkbox" name="11_sustainable_cities_and_communities"
                            id="11_sustainable_cities_and_communities">
                        <label for="11_sustainable_cities_and_communities">SDG 11 - Sustainable Cities and
                            Communities</label>
                    </div>
                    <div>
                        <input type="checkbox" name="12_responsible_consumption_and_production"
                            id="12_responsible_consumption_and_production">
                        <label for="12_responsible_consumption_and_production">SDG 12 - Responsible Consumption and
                            Production</label>
                    </div>
                    <div>
                        <input type="checkbox" name="14_life_below_water" id="14_life_below_water">
                        <label for="14_life_below_water">SDG 14 - Life Below Water</label>
                    </div>
                    <div>
                        <input type="checkbox" name="15_life_on_land" id="15_life_on_land">
                        <label for="15_life_on_land">SDG 15 - Life on Land</label>
                    </div>
                    <div>
                        <input type="checkbox" name="16_peace_and_justice" id="16_peace_and_justice">
                        <label for="16_peace_and_justice">SDG 16 - Peace and Justice Strong Institutions</label>
                    </div>
                    <div>
                        <input type="checkbox" name="17_partnerships_for_the_goals" id="17_partnerships_for_the_goals">
                        <label for="17_partnerships_for_the_goals">SDG 17 - Partnerships for the Goals</label>
                    </div>
                </div>
            </div>

            <div class="labelAndInput">
                <label for="solution_description">Which Google Technologies does your solution utilise?</label>
                <div class="tech_container">
                    <div>
                        <input type="checkbox" name="gcp" id="gcp">
                        <label for="gcp">Google Cloud Platform</label>
                    </div>
                    <div>
                        <input type="checkbox" name="google_maps_platform" id="google_maps_platform">
                        <label for="google_maps_platform">Google Maps Platform</label>
                    </div>
                    <div>
                        <input type="checkbox" name="android" id="android">
                        <label for="android">Android</label>
                    </div>
                    <div>
                        <input type="checkbox" name="angular" id="angular">
                        <label for="angular">Angular</label>
                    </div>
                    <div>
                        <input type="checkbox" name="ar_vr" id="ar_vr">
                        <label for="ar_vr">AR/VR</label>
                    </div>
                    <div>
                        <input type="checkbox" name="earth_engine" id="earth_engine">
                        <label for="earth_engine">Earth Engine</label>
                    </div>
                    <div>
                        <input type="checkbox" name="firebase" id="firebase">
                        <label for="firebase">Google Firebase</label>
                    </div>
                    <div>
                        <input type="checkbox" name="web_toolkit" id="web_toolkit">
                        <label for="web_toolkit">Web Toolkit</label>
                    </div>
                    <div>
                        <input type="checkbox" name="flutter" id="flutter">
                        <label for="flutter">Flutter</label>
                    </div>
                    <div>
                        <input type="checkbox" name="google_assistant" id="google_assistant">
                        <label for="google_assistant">Google Assistant</label>
                    </div>
                    <div>
                        <input type="checkbox" name="google_analytics" id="google_analytics">
                        <label for="google_analytics">Google Analytics</label>
                    </div>
                    <div>
                        <input type="checkbox" name="google_play" id="google_play">
                        <label for="google_play">Google Play</label>
                    </div>
                    <div>
                        <input type="checkbox" name="google_pay" id="google_pay">
                        <label for="google_pay">Google pay</label>
                    </div>
                    <div>
                        <input type="checkbox" name="google_wallet" id="google_wallet">
                        <label for="google_wallet">Google Wallet</label>
                    </div>
                    <div>
                        <input type="checkbox" name="google_workspace" id="google_workspace">
                        <label for="google_workspace">Google Workspace</label>
                    </div>
                    <div>
                        <input type="checkbox" name="machine_learning" id="machine_learning">
                        <label for="machine_learning">Machine Learning</label>
                    </div>
                    <div>
                        <input type="checkbox" name="progressive_web_apps" id="progressive_web_apps">
                        <label for="progressive_web_apps">Web / Progressive Web Apps</label>
                    </div>
                    <div id="others-checkbox-div">
                        <input type="checkbox" name="Other" id="Other" onchange="onOthersClick()">
                        <label for="Other">Other</label>
                    </div>
                </div>
            </div>

            <input type="submit" value="Register" onclick="register(event)">

        </form>
        <div id="success-popup" class="popup">
            <div class="popup-content">
                <h2>Registration Successful</h2>
                <p>
                    You are successfully registered for Inventia'24. Contact us if you haven't received a confirmation email.
                </p>
                <button onclick="closePopup()">Close</button>
            </div>
        </div>

        <div class="problem-contact">
            <span>If you face any problems with registering, please email us at <a href="mailto:gdsckare@klu.ac.in">gdsckare@klu.ac.in</a> or contact <b>9443634173</b></span>
        </div>

        <footer>
            <div class="text">Created and maintained by GDSC KARE.</div>
            <div class="links">
                <a target="_blank" href="https://in.linkedin.com/company/gdsc-kare">linkedin</a>
                <a target="_blank" href="https://www.instagram.com/gdsc_kare/">instagram</a>
                <a target="_blank" href="https://linktr.ee/gdsc_kare">linktree</a>
            </div>
        </footer>

    </div>

</body>

<script>

    function onOthersClick() {
        checkboxDiv = document.getElementById('others-checkbox-div');

        if (checkboxDiv.children.length === 2) {
            let input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'Other technologies';
            input.id = 'others-input';

            let addButton = document.createElement('input');
            addButton.type = 'button'
            addButton.value = 'Add';
            addButton.className = 'add-button';

            addButton.onclick = addNewTech;

            let entryBoxDiv = document.createElement('div');
            entryBoxDiv.id = 'others-entry-box';

            entryBoxDiv.appendChild(input);
            entryBoxDiv.appendChild(addButton);

            checkboxDiv.appendChild(entryBoxDiv);
        } else {
            checkboxDiv.removeChild(checkboxDiv.children[2]);
        }
    }

    function addNewTech() {
        let otherTechName = document.getElementById('others-input').value;

        let techCheckBoxes = document.querySelectorAll('.tech_container input[type="checkbox"]');

        let duplicateName = false;

        techCheckBoxes.forEach(checkbox => {
            console.log(checkbox.name)
            console.log(otherTechName)
            if (checkbox.name == otherTechName) {
                duplicateName = true;
                return;
            }
        });

        if (otherTechName === '' || duplicateName) {
            return;
        }

        let techContainerDiv = document.querySelector('.tech_container');
        let newTechEle = document.createElement('div');
        newTechEle.innerHTML = `
            <input type="checkbox" name="${otherTechName}" id="${otherTechName}" checked>
            <label for="${otherTechName}">${otherTechName}</label>
        `
        document.getElementById('others-input').value = '';
        techContainerDiv.appendChild(newTechEle);
    }

    function closePopup() {
        let successPopup = document.getElementById('success-popup');
        successPopup.classList.remove('open');
        window.location.replace("https://gdsckare.github.io/inventia.html");
    }

    function replaceUnderscores(obj) {
        if (typeof obj === 'string') {
            return obj.replace(/_/g, ' ');
        } else if (Array.isArray(obj)) {
            return obj.map(item => replaceUnderscores(item));
        } else if (typeof obj === 'object' && obj !== null) {
            const newObj = {};
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    newObj[key] = replaceUnderscores(obj[key]);
                }
            }
            return newObj;
        }
        return obj;
    }
</script>

<script type="module" defer>
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"

    const firebaseConfig = {
        apiKey: "AIzaSyC9-X-0RCNBxXzCGtXpjmD8Z1EBbzfiMjs",
        authDomain: "gdsc-kare.firebaseapp.com",
        databaseURL: "https://gdsc-kare-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gdsc-kare",
        storageBucket: "gdsc-kare.appspot.com",
        messagingSenderId: "690496105686",
        appId: "1:690496105686:web:60eed1291c7efd9df86d77"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    async function fetchDataFromFirebase(path) {
        const dbRef = ref(db, path);

        try {
            const snapshot = await get(dbRef);
            if (snapshot.exists()) {
                return snapshot.val();
            } else {
                throw new Error('No data available at the specified path.');
            }
        } catch (error) {
            console.error('Error fetching data:', error);
            throw error;
        }
    }

    function extractRegNumbers(jsonData) {
        let regNumbers = new Set();
        
        for (let data in jsonData) {

            if (jsonData[data]) {
                
                jsonData[data].teamMembers.forEach(member => {
                    if (member.reg) {
                        regNumbers.add(member.reg);
                    }
                });
            }
            if (jsonData[data].team_leader_reg) {
                regNumbers.add(jsonData[data].team_leader_reg);
            }
        };
        console.log(regNumbers)
        return regNumbers;
    }

    function checkForDuplicates(currentDetails, data) {
        let allRegNumbers = new Set();
        let hasDuplicates = false;
        let duplicateNum = null;

        allRegNumbers = extractRegNumbers(data);
        console.log(allRegNumbers)

        currentDetails.teamMembers.forEach(mem => {
            if (allRegNumbers.has(mem.reg)) {
                hasDuplicates = true;
                duplicateNum = mem.reg;
            }
        });
        
        if (allRegNumbers.has(currentDetails.team_leader_reg)) {
            hasDuplicates = true;
            duplicateNum = currentDetails.team_leader_reg;
        }

        return [hasDuplicates, duplicateNum];
    }

    function register(e) {
        if (document.getElementById('Other').checked) {
            document.getElementById('Other').click();
        }

        e.preventDefault();
        let form = document.querySelector("form");
        
        let isValid = form.reportValidity();
        if (!isValid) {
            return;
        }

        let requiredFields = document.querySelectorAll('input[required]');
        for (var i = 0; i < requiredFields.length; i++) {
            if (requiredFields[i].value === "") {
                alert("Please fill all the required fields.");
                return;
            }
        }

        // if (!form.reportValidity()) {
        //     console.log(form.reportValidity())
        //     return;
        // }

        let sdgCheckboxes = document.querySelectorAll('.sdgGoalsContainer input[type="checkbox"]');
        let atleaseOneChecked = false;
        let solvedSDGs = []
        for (var i = 0; i < sdgCheckboxes.length; i++) {
            if (sdgCheckboxes[i].checked) {
                atleaseOneChecked = true;
                solvedSDGs.push(sdgCheckboxes[i].name);
            };
        };

        if (!atleaseOneChecked) {
            alert("Your solution must achieve atleast one Sustainable Development Goal.");
            return;
        }

        let techCheckBoxes = document.querySelectorAll('.tech_container input[type="checkbox"]');
        let atleaseOneTechChecked = false;
        let usedTech = []
        for (var i = 0; i < techCheckBoxes.length; i++) {
            if (techCheckBoxes[i].checked) {
                atleaseOneTechChecked = true;
                usedTech.push(techCheckBoxes[i].name);
            };
        };

        if (!atleaseOneTechChecked) {
            alert("Your solution must use one or more of the technologies mentioned.");
            return;
        }

        let teamMembers = []
        let teamSize = document.querySelector("#team_size").value;
        for (let i = 1; i < teamSize; i++) {
            let teamMember = {
                name: document.querySelector(`#team_member${i}_name`).value,
                reg: document.querySelector(`#team_member${i}_reg`).value,
                email: document.querySelector(`#team_member${i}_email`).value,
                number: document.querySelector(`#team_member${i}_number`).value
            }
            teamMembers.push(teamMember);
        }

        let details = {
            team_name: document.querySelector("#team_name").value,
            team_size: document.querySelector("#team_size").value,
            team_leader_name: document.querySelector("#team_leader_name").value,
            team_leader_reg: document.querySelector("#team_leader_reg").value,
            team_leader_email: document.querySelector("#team_leader_email").value,
            team_leader_number: document.querySelector("#team_leader_number").value,
            teamMembers: teamMembers,
            solution_title: document.querySelector("#solution_title").value,
            solution_description: document.querySelector("#solution_description").value,
            solvedSDGs: solvedSDGs,
            usedTech: usedTech
        }

        console.log("Registering");

        let dbData = {}

        fetchDataFromFirebase('/inventia_registrations').then(data => {
            dbData = data
            
        let isDupNum = checkForDuplicates(details, dbData);
        let isDuplicate = isDupNum[0];
        let duplicateNum = isDupNum[1];

        if (isDuplicate) {
            alert(`${duplicateNum} is already registered in a team. If you think this is a mistake, please find our contact at the bottom of the registration page`);
            return;
        }

        push(ref(db, 'inventia_registrations'), {
            ...details
        })
            .then(() => {
                let successPopup = document.getElementById('success-popup');
                successPopup.classList.add('open');

                form.reset();

                const updatedData = replaceUnderscores(details);
                console.log(updatedData)

                const serviceID = 'service_h9erwq3'
                const templateID = 'template_v0fhogn'

                emailjs.send(serviceID, templateID, updatedData)
                    .then((res) => {
                        console.log("Email sent successfully!")
                    })
                    .catch((err) => {
                        console.log("Error in sending email")
                    })
            })

            .catch((err) => {
                alert("Error in registering. Please try again later.");
            })
        }).catch(error => {
            console.error('Error:', error);
        });
    }
    window.register = register;

    function teamSizeChanged(e) {
        let teamSize = document.querySelector("select");
        console.log(`teamSize changed to ${teamSize.value}`);

        if (teamSize.value === '2') {
            document.querySelector(`.teamMember2Details`).style.display = "none";
            let allMember2Details = document.querySelectorAll(`.teamMember2Details input`)
            for (var i = 0; i < allMember2Details.length; i++) {
                allMember2Details[i].removeAttribute("required");
            }

            document.querySelector(`.teamMember3Details`).style.display = "none";
            document.querySelector(`.teamMember3Details`).style.display = "none";
            let allMember3Details = document.querySelectorAll(`.teamMember3Details input`)
            for (var i = 0; i < allMember3Details.length; i++) {
                allMember3Details[i].removeAttribute("required");
            }
            document.querySelector(`.splitter1`).style.display = "block";
            document.querySelector(`.splitter2`).style.display = "none";
            document.querySelector(`.splitter3`).style.display = "none";
            document.querySelector(`.splitter4`).style.display = "block";
        }
        if (teamSize.value === '3') {
            document.querySelector(`.teamMember2Details`).style.display = "block";
            let allMember2Details = document.querySelectorAll(`.teamMember2Details input`)
            for (var i = 0; i < allMember2Details.length; i++) {
                allMember2Details[i].setAttribute("required");
            }
            document.querySelector(`.teamMember3Details`).style.display = "none";
            let allMember3Details = document.querySelectorAll(`.teamMember3Details input`)
            for (var i = 0; i < allMember3Details.length; i++) {
                allMember3Details[i].removeAttribute("required");
            }
            document.querySelector(`.splitter1`).style.display = "block";
            document.querySelector(`.splitter2`).style.display = "block";
            document.querySelector(`.splitter3`).style.display = "block";
            document.querySelector(`.splitter4`).style.display = "none";
        }
        if (teamSize.value === '4') {
            document.querySelector(`.teamMember2Details`).style.display = "block";
            document.querySelector(`.teamMember3Details`).style.display = "block";

            let allMember2Details = document.querySelectorAll(`.teamMember2Details input`)
            for (var i = 0; i < allMember2Details.length; i++) {
                allMember2Details[i].setAttribute("required");
            }
            document.querySelector(`.teamMember3Details`).style.display = "none";
            let allMember3Details = document.querySelectorAll(`.teamMember3Details input`)
            for (var i = 0; i < allMember3Details.length; i++) {
                allMember3Details[i].setAttribute("required");
            }

            document.querySelector(`.splitter1`).style.display = "block";
            document.querySelector(`.splitter2`).style.display = "block";
            document.querySelector(`.splitter3`).style.display = "block";
            document.querySelector(`.splitter4`).style.display = "block";
        }
    }
    window.teamSizeChanged = teamSizeChanged;


</script>

</html>